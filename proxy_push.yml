# Global config items

# Timeouts
timeout:
  globalTimeout: 300s # Global timeout
  exptTimeout:   60s # Experiment timeout
  pingTimeout:   20s # Ping timeout (for all pings per experiment)
  vpiTimeout:    10s # voms-proxy-init timeout (total for vpis per experiment)
  copyTimeout:   30s # copy proxy timeout (total for all copies per experiment)
  slackTimeout:  15s # Slack message timeout
  emailTimeout:  30s # Email timeout (per email)

# Logging/Error handling files.
logs:
  logfile:  proxy_push.log
  errfile:  proxy_push.err      # Set the temporary output file for errors.  
  debugfile: proxy_push.debug.log


# Global email and slack notification parameters
notifications:
  # SLACK_ALERTS_URL:  "https://hooks.slack.com/services/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"      # Slack url for #alerts channel in fife-group slack
  SLACK_ALERTS_URL: "https://hooks.slack.com/services/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"      # Slack url for #fifealerts channel in fnal slack
  admin_email: fife-group@fnal.gov
 

# Same as above, but used in test runs
notifications_test:
  # SLACK_ALERTS_URL: "https://hooks.slack.com/services/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"      # Slack url for #alerts-dev channel in fife-group slack.  Use for testing
  SLACK_ALERTS_URL: "https://hooks.slack.com/services/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"     # Slack url for #fifealertsdev channel in fnal slack.  Use for testing
  admin_email: sbhat@fnal.gov
  # admin_email: kherner@fnal.gov
  

# Experiments
# Note: accounts entries should be of the form "account_name: Role_name"
experiments:
  coupp:
    dir: /opt
    emails: [hugh@fnal.gov]
    nodes: [couppgpvm01, couppgpvm02]
    accounts:
      coupp: Production
  darkside:
    dir: /opt
    emails: [kherner@fnal.gov]
    nodes: [ds50samgpvm01]
    accounts:
      darksidepro: Production
  des:
    dir: /opt
    emails: [buckley@fnal.gov]
    nodes: [des30, des40, des41, des50, des51, des60, des61, des70, des71]
    accounts:
      desgw: DESGW
    vomsgroup: "des:/des/"
  dune:
    dir: /opt
    emails: [trj@fnal.gov, fuess@fnal.gov, berman@fnal.gov, anorman@fnal.gov]
    nodes: [dunegpvm01, dunegpvm02, dunegpvm03, dunegpvm04, dunegpvm05, dunegpvm06,
      dunegpvm07, dunegpvm08, dunegpvm09, dunegpvm10, dunesamgpvm02, dunesl7gpvm01]
    accounts:
      dunepro: Production
    vomsgroup: "dune:/dune/"
  genie:
    dir: /opt
    emails: [perdue@fnal.gov]
    nodes: [geniegpvm01]
    accounts:
      geniepro: Production
  gm2:
    dir: /opt
    emails: [lyon@fnal.gov]
    nodes: [gm2gpvm01, gm2gpvm02, gm2gpvm03, gm2gpvm04, gm2samgpvm01]
    accounts:
      gm2pro: Production
  icarus:
    dir: /opt
    emails: [wketchum@fnal.gov]
    nodes: [icarusgpvm01, icarussamgpvm01]
    accounts:
      icaruspro: Production
  lariat:
    dir: /opt
    emails: [wenzel@fnal.gov]
    nodes: [lariatsamgpvm01]
    accounts:
      lariatpro: Production
  minerva:
    dir: /opt
    emails: [perdue@fnal.gov, jyhan@fnal.gov]
    nodes: [minervagpvm01, minervagpvm02, minervagpvm03, minervagpvm04, minervagpvm05,
      minervagpvm06, minervagpvm07]
    accounts:
      minervacal: Calibration
      minervapro: Production
      minervadat: Data
  minos:
    dir: /opt
    emails: [kreymer@fnal.gov, wingmc@fnal.gov]
    nodes: [minosdatagpvm01, minosgpvm05]
    accounts:
      minospro: Production
  mu2e:
    dir: /opt
    emails: [kutschke@fnal.gov, rlc@fnal.gov, gandr@fnal.gov]
    nodes: [mu2egpvm01, mu2egpvm02, mu2egpvm03, mu2egpvm04, mu2egpvm05, mu2egpvm06]
    accounts:
      mu2epro: Production
  nova:
    dir: /opt
    emails: [dingpf@fnal.gov, aaron.mislivec@gmail.com, karlwarb@iastate.edu]
    nodes: [novagpvm01, novagpvm02, novagpvm03, novagpvm04, novagpvm05, novagpvm06,
      novagpvm07, novagpvm08, novagpvm09, novagpvm10, novagpvm11, novagpvm12, novagpvm13,
      novagpvm14, novagpvm15, novadqgpvm01]
    accounts:
      novapro: Production
  sbnd:
    dir: /opt
    emails: [vito@fnal.gov]
    nodes: [sbndgpvm01, sbndgpvm02, sbndgpvm03, sbndsamgpvm01]
    accounts:
      sbndpro: Production
  uboone:
    dir: /opt
    emails: [greenlee@fnal.gov, wtang8@utk.edu, renlu23@nmsu.edu]
    nodes: [uboonegpvm01, uboonegpvm02, uboonegpvm03, uboonegpvm04, uboonegpvm05, uboonegpvm06, uboonegpvm07, uboonebuild02]
    accounts:
      uboonepro: Production
  p-argoneutcode:
    dir: /opt/ci_proxy/lar_ci
    emails: [vito@fnal.gov,]
    nodes: [cdcvs, ]
    accounts:
      p-argoneutcode: Analysis
    vomsgroup: "fermilab:/fermilab/argoneut/"
    certfile: "/opt/gen_push_proxy/certs/CI-service.cert" 
    keyfile:  "/opt/gen_push_proxy/certs/CI-service.key"
  p-lardbt:
    dir: /opt/ci_proxy/lar_ci
    emails: [vito@fnal.gov,]
    nodes: [cdcvs, ]
    accounts:
      p-lardbt: Analysis
    vomsgroup: "fermilab:/fermilab/lariat/"
    certfile: "/opt/gen_push_proxy/certs/CI-service.cert" 
    keyfile:  "/opt/gen_push_proxy/certs/CI-service.key"
  p-larsoft:
    dir: /opt/ci_proxy/lar_ci
    emails: [vito@fnal.gov, sbhat@fnal.gov]
    nodes: [cdcvs, ]
    accounts:
      p-larsoft: Analysis
    vomsgroup: "fermilab:/fermilab/uboone/"
    certfile: "/opt/gen_push_proxy/certs/CI-service.cert" 
    keyfile:  "/opt/gen_push_proxy/certs/CI-service.key"
  p-sbndcode:
    dir: /opt/ci_proxy/lar_ci
    emails: [vito@fnal.gov]
    nodes: [cdcvs, ]
    accounts:
      p-sbndcode: Analysis
    vomsgroup: "fermilab:/fermilab/sbnd/"
    certfile: "/opt/gen_push_proxy/certs/CI-service.cert"
    keyfile:  "/opt/gen_push_proxy/certs/CI-service.key"
  p-uboonecode:
    dir: /opt/ci_proxy/lar_ci
    emails: [vito@fnal.gov]
    nodes: [cdcvs, ]
    accounts:
      p-uboonecode: Analysis
    vomsgroup: "fermilab:/fermilab/uboone/"
    certfile: "/opt/gen_push_proxy/certs/CI-service.cert"
    keyfile:  "/opt/gen_push_proxy/certs/CI-service.key"
  p-dunetpc:
    dir: /opt/ci_proxy/lar_ci
    emails: [vito@fnal.gov]
    nodes: [cdcvs, ]
    accounts:
      p-dunetpc: Analysis
    vomsgroup: "dune:/dune/"
    certfile: "/opt/gen_push_proxy/certs/CI-service.cert"
    keyfile:  "/opt/gen_push_proxy/certs/CI-service.key"
  p-novaart:
    dir: /opt/ci_proxy/nova_ci
    emails: [vito@fnal.gov]
    nodes: [cdcvs, ]
    accounts:
      p-novaart: Analysis
    vomsgroup: "fermilab:/fermilab/nova/"
    certfile: "/opt/gen_push_proxy/certs/CI-service.cert"
    keyfile:  "/opt/gen_push_proxy/certs/CI-service.key"



# Other config variabless
global:
  should_runuser: rexbatch                                    # User that this script must run as 
  CERT_BASE_DIR: "/opt/gen_push_proxy/certs"                      # base location for certs/keys
  smtphost: localhost
  smtpport: 25 
  # Note:  unless there is a certfile and/or keyfile override below in a given stanza, the proxy_push assumes that the cert/key for each experiment/role is located at CERT_BASE_DIR/<account>.{cert|key}.  e.g. novapro.cert and novapro.key

# Prometheus monitoring config
prometheus:
  #host: "http://fermicloud149.fnal.gov:9091"
  host: "http://lssrv01.fnal.gov:9091"
  jobname: "proxy_push_tracker"
  

# Command templates and arguments 
vomsProxyInit:
  defaultVomsPrefixRoot: "fermilab:/fermilab/" 
  executable: /usr/bin/voms-proxy-init
  vpiCommand: "-rfc -valid 24:00 -voms {{.VomsFQAN}} -cert {{.CertFile}} -key {{.KeyFile}} -out {{.OutfilePath}}"

kerberos:
  KRB5CCNAME:  "FILE:/tmp/krb5cc_push_proxy"  # What the env variable KRB5CCNAME should be set to
  kinitExecutable: /usr/krb5/bin/kinit
  kinitArgs: "-k -t /opt/gen_keytabs/config/gcso_monitor.keytab monitor/gcso/fermigrid.fnal.gov@FNAL.GOV"

ping:
  pingArgs: "-W 5 -c 1 {{.Node}}"

ssh:
  sshOpts: "-o ConnectTimeout=30 -o ServerAliveInterval=30 -o ServerAliveCountMax=1"
  scpArgs: "{{.ProxySourcePath}} {{.Account}}@{{.Node}}.fnal.gov:{{.NewProxyPath}}"
  chmodArgs: "{{.Account}}@{{.Node}}.fnal.gov chmod 400 {{.NewProxyPath}} ; mv -f {{.NewProxyPath}} {{.FinalProxyPath}}"


